(function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=2)})({2:function(e,t,o){e.exports=o("ecea")},ecea:function(e,t){let o=null,n=!0,i=!1;function r(e,t){let i,r;location.href.includes("bilibili.com/bangumi/play/")?(i="result",r=a()):location.href.includes("bilibili.com/video/")&&(r=c(),i="data"),fetch(r,{method:"get",credentials:"include",headers:{cookie:"SESSDATA="+e+";","User-Agent":navigator.userAgent,Host:"api.bilibili.com"}}).then(e=>e.json()).then(e=>{var r,l,d;console.log(e[i]),document.querySelector("#bili_downloader").href=null===(r=e[i])||void 0===r?void 0:r.durl[0].url,o=null===(l=e[i])||void 0===l?void 0:l.durl[0].size,n=!(location.href.includes("bilibili.com/bangumi/play/")&&(null===(d=e[i])||void 0===d||!d.video_project)),t&&t()})}function l(e,t,o){chrome.runtime.sendMessage({action:"sendAli",type:e,control:t,lable:o},(function(e){}))}chrome.runtime.onMessage.addListener((e,t,d)=>{var c,u;switch(e.cmd){case"getInfo":return chrome.storage.local.get(["sessdata"],(function(e){let t=e.sessdata?e.sessdata:"";r(t,()=>{var e,t;d({videoName:(null===(e=document.querySelector("#viewbox_report .video-title"))||void 0===e?void 0:e.title)||(null===(t=document.querySelector("#player-title"))||void 0===t?void 0:t.innerHTML),size:o,allowDownload:n,isDownload:i})})})),!0;case"download":let e="drama";location.href.includes("play/")||(e="recommend"),s(document.querySelector("#bili_downloader").href,(null===(c=document.querySelector("#viewbox_report .video-title"))||void 0===c?void 0:c.title)||(null===(u=document.querySelector("#player-title"))||void 0===u?void 0:u.innerHTML)),l("Download","download",e);default:break}});let d=(e,t)=>{const o=[];return Object.keys(t).forEach(e=>t[e]&&o.push(`${e}=${t[e]}`)),-1===e.search(/\?/)?e+="?"+o.join("&"):e+="&"+o.join("&"),e};function c(){let e={cid:document.querySelector("#bili_downloader").getAttribute("cid"),qn:80,bvid:location.href.split("video/")[1].substring(0,12),otype:"json"};return d("https://api.bilibili.com/x/player/playurl",e)}function u(){try{const e=JSON.parse(document.getElementById("__NEXT_DATA__").innerHTML);let t=e["props"]["pageProps"]["dehydratedState"]["queries"][0]["state"]["data"]["mediaInfo"]["episodes"][0]["ep_id"];return t}catch(e){return""}}function a(){var e,t,o,n;document.querySelector("#bili_downloader").setAttribute("ep_id",location.href.split("?")[0].includes("ss")?u():location.href.split("?")[0].replace(/[^0-9]/gi,"")||(null===(e=document.querySelector(".ep-item.cursor a"))||void 0===e?void 0:e.href.match(/ep(\S*)\//)[1])||document.querySelector("#bili_downloader").getAttribute("ep_id"));let i={ep_id:document.querySelector("#bili_downloader").getAttribute("ep_id"),qn:null!==(t=document.querySelector(".squirtle-select-item.active"))&&void 0!==t&&t.getAttribute("data-value")?"16"!=(null===(o=document.querySelector(".squirtle-select-item.active"))||void 0===o?void 0:o.getAttribute("data-value"))?null===(n=document.querySelector(".squirtle-select-item.active"))||void 0===n?void 0:n.getAttribute("data-value"):"32":"64"};return d("https://api.bilibili.com/pgc/player/web/playurl/",i)}function s(e,t){i=!0;var o=new XMLHttpRequest;o.onprogress=function(e){e.lengthComputable&&(console.log(e.loaded/e.total*100+"%"),chrome.runtime.sendMessage({action:"process",isDownload:i,process:e.loaded/e.total*100+"%"}))},o.onload=function(e){},o.onreadystatechange=function(){if(o.readyState===XMLHttpRequest.DONE){const e=new Blob([o.response]),n=document.createElement("a"),r=window.URL.createObjectURL(e);n.href=r,n.download=t+".mp4",document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r),i=!1,chrome.runtime.sendMessage({action:"process",isDownload:i})}},o.open("GET",e,!0),o.responseType="blob",o.send()}}});